[phases.setup]
nixPkgs = ["erlang", "elixir", "nodejs", "npm"]

[phases.install]
cmds = [
  "mix local.hex --force",
  "mix local.rebar --force",
  "mix deps.get --only prod"
]

[phases.build]
cmds = [
  "cd assets && npm ci --production=false && cd ..",
  "mix compile",
  "mix assets.deploy",
  "mix release",
  "ls -la priv/static/images/ || echo 'Images dir missing'",
  "ls -la _build/prod/rel/pavoi/lib/pavoi-*/priv/static/images/ || echo 'Images not in release'"
]

[start]
cmd = "_build/prod/rel/pavoi/bin/pavoi eval \"Pavoi.Release.migrate\" && _build/prod/rel/pavoi/bin/pavoi start"
