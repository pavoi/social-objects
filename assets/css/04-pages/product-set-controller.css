/* ============================================================================
   PRODUCT SET CONTROLLER VIEW - Tailwind Migration
   ============================================================================
   Mobile-optimized remote control for product set management.
   Uses @apply for base styles while maintaining existing class API.
   ============================================================================ */

/* ==========================================================================
   MAIN CONTAINER
   ========================================================================== */

.controller-container {
  @apply flex flex-col bg-bg-primary overflow-hidden;
  height: 100vh;
  height: 100dvh;
  padding-top: env(safe-area-inset-top);
  padding-right: env(safe-area-inset-right);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
}

/* ==========================================================================
   COLLAPSIBLE PANEL (Shared styles for Message & Voice)
   ========================================================================== */

.controller-panel {
  @apply shrink-0;
  background-color: var(--color-panel-bg);
  border: 1px solid var(--color-panel-border);
  border-left: none;
  border-right: none;
}

.controller-panel__header {
  @apply flex items-center gap-3 py-3 px-4 bg-transparent border-none w-full cursor-pointer select-none text-left;
  color: inherit;
  font-family: inherit;
  -webkit-tap-highlight-color: transparent;
}

.controller-panel__header:active {
  @apply bg-bg-hover;
}

.controller-panel__title {
  @apply flex-1 text-sm font-semibold text-text-primary;
}

.controller-panel__chevron {
  @apply w-5 h-5 text-text-tertiary;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.controller-panel--collapsed .controller-panel__chevron {
  transform: rotate(180deg);
}

.controller-panel__body {
  @apply px-4 pb-4 max-h-[300px] overflow-hidden opacity-100;
  padding-top: 0;
  transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1),
              opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
              padding 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.controller-panel--collapsed .controller-panel__body {
  @apply max-h-0 opacity-0 p-0;
}

/* ==========================================================================
   MESSAGE PANEL
   ========================================================================== */

.message-preview {
  @apply flex items-center gap-1.5 py-1 px-1.5 pl-2.5 max-w-[200px];
  border-radius: 12px;
}

.message-preview__text {
  @apply text-[11px] font-medium leading-tight overflow-hidden text-ellipsis whitespace-nowrap min-w-0;
}

/* Color variants for preview */
.message-preview--amber {
  background-color: var(--color-accent-amber);
  color: #000;
}

.message-preview--blue {
  background-color: var(--color-accent-blue);
  color: #fff;
}

.message-preview--green {
  background-color: var(--color-accent-green);
  color: #fff;
}

.message-preview--red {
  background-color: var(--color-accent-red);
  color: #fff;
}

.message-preview--purple {
  background-color: var(--color-accent-purple);
  color: #fff;
}

.message-preview--gray {
  background-color: var(--color-text-secondary);
  color: #fff;
}

/* Clear button inside preview bubble */
.message-preview__clear {
  @apply flex items-center justify-center w-4 h-4 p-0 border-none text-sm leading-none cursor-pointer shrink-0 opacity-80;
  background: rgba(0, 0, 0, 0.2);
  border-radius: var(--radius-full);
  color: inherit;
  transition: background var(--transition-fast);
}

.message-preview__clear:hover {
  @apply opacity-100;
  background: rgba(0, 0, 0, 0.35);
}

.message-preview__clear:active {
  transform: scale(0.9);
}

.controller-message-form {
  @apply flex flex-col gap-3;
}

.controller-message-input {
  @apply w-full p-3 bg-surface-secondary text-text-primary text-base resize-none min-h-[60px];
  border: 1px solid var(--color-border-primary);
  border-radius: var(--radius-md);
  font-family: inherit;
  transition: border-color var(--transition-fast);
}

.controller-message-input:focus {
  @apply outline-none;
  border-color: var(--color-border-focus);
}

.controller-message-input::placeholder {
  @apply text-text-tertiary;
}

.controller-message-actions {
  @apply flex items-center justify-between gap-3;
}

/* Inline Color Picker */
.controller-color-picker {
  @apply flex gap-1 items-center;
}

.controller-color-btn {
  @apply w-[22px] h-[22px] cursor-pointer p-0;
  border-radius: var(--radius-full);
  border: 2px solid transparent;
  transition: all var(--transition-fast);
  -webkit-tap-highlight-color: transparent;
}

.controller-color-btn:active {
  transform: scale(0.9);
}

.controller-color-btn--active {
  @apply text-text-primary;
  border-color: var(--color-text-primary);
  transform: scale(1.1);
  box-shadow: 0 0 0 2px var(--color-bg-primary);
}

.controller-message-buttons {
  @apply flex gap-2;
}

/* Controller Buttons */
.controller-btn {
  @apply flex items-center justify-center py-2 px-4 text-sm font-medium leading-none cursor-pointer border-none;
  border-radius: 6px;
  transition: all 0.2s ease;
  -webkit-tap-highlight-color: transparent;
  font-family: inherit;
}

.controller-btn:active {
  transform: scale(0.95);
}

.controller-btn--primary {
  background-color: var(--color-accent-blue);
  color: var(--color-text-inverse);
}

.controller-btn--primary:active {
  background-color: var(--color-accent-blue-hover);
}

.controller-btn--secondary {
  @apply bg-surface-secondary text-text-primary;
  border: 1px solid var(--color-border-primary);
  padding: 7px 15px;
}

.controller-btn--secondary:active {
  @apply bg-bg-hover;
}

/* ==========================================================================
   HEADER
   ========================================================================== */

.controller-header {
  @apply flex items-center justify-between gap-3 py-3 px-4 shrink-0;
  background-color: var(--color-panel-bg);
  border-bottom: 1px solid var(--color-panel-border);
}

.controller-back-link {
  @apply flex items-center justify-center w-8 h-8 text-text-secondary no-underline shrink-0;
  border-radius: var(--radius-md);
  transition: all var(--transition-fast);
}

.controller-back-link:hover,
.controller-back-link:active {
  @apply bg-bg-hover text-text-primary;
}

.controller-back-icon {
  @apply w-5 h-5;
}

.controller-header__title {
  @apply text-sm font-semibold text-text-primary overflow-hidden text-ellipsis whitespace-nowrap flex-1 min-w-0;
}

.controller-header__count {
  @apply text-xs font-medium text-text-tertiary shrink-0 bg-bg-tertiary py-1 px-2;
  border-radius: var(--radius-sm);
}

/* iOS-style toggle for product set notes */
.controller-notes-toggle {
  @apply flex items-center gap-2 p-0 border-none bg-transparent cursor-pointer shrink-0;
  -webkit-tap-highlight-color: transparent;
}

.controller-notes-toggle__label {
  @apply text-xs font-medium text-text-secondary whitespace-nowrap;
}

.controller-notes-toggle__track {
  @apply relative w-11 h-[26px] bg-bg-tertiary shrink-0;
  border-radius: 13px;
  transition: background-color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.controller-notes-toggle__thumb {
  @apply absolute bg-white;
  top: 2px;
  left: 2px;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.controller-notes-toggle--on .controller-notes-toggle__track {
  background-color: var(--color-accent-green);
}

.controller-notes-toggle--on .controller-notes-toggle__thumb {
  transform: translateX(18px);
}

/* ==========================================================================
   PRODUCTS SECTION
   ========================================================================== */

.controller-products {
  @apply flex-1 min-h-0 flex flex-col overflow-hidden;
}

.controller-products__grid {
  @apply flex-1 min-h-0 overflow-y-auto overflow-x-hidden p-3 grid gap-2;
  grid-template-columns: repeat(2, 1fr);
  align-content: start;
  align-items: start;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

/* ==========================================================================
   PRODUCT CARD
   ========================================================================== */

.controller-product-card {
  @apply block relative overflow-hidden cursor-pointer p-0 m-0 w-full min-w-0 min-h-0 text-left;
  -webkit-appearance: none;
  appearance: none;
  font: inherit;
  border: none;
  background: none;
  background-color: var(--color-surface-primary);
  border: 2px solid var(--color-border-secondary);
  border-radius: var(--radius-md);
  transition: all var(--transition-fast);
  -webkit-tap-highlight-color: transparent;
  height: min-content;
}

.controller-product-card:active {
  transform: scale(0.95);
}

.controller-product-card--active {
  border-color: var(--color-accent-blue);
  box-shadow: 0 0 0 2px var(--color-accent-blue);
}

/* Image container - guaranteed square */
.controller-product-card__image-container {
  @apply block relative w-full overflow-hidden;
  aspect-ratio: 1 / 1;
  background-color: var(--color-bg-tertiary);
}

/* Position Badge */
.controller-product-card__position {
  @apply absolute flex items-center justify-center min-w-[44px] h-11 px-2 text-white text-2xl font-bold z-[1];
  top: var(--space-1);
  left: var(--space-1);
  background-color: rgba(0, 0, 0, 0.7);
  border-radius: var(--radius-sm);
}

/* Image fills the container */
.controller-product-card__image {
  @apply absolute top-0 left-0 w-full h-full object-cover;
}

/* Product Name */
.controller-product-card__name {
  @apply py-1 px-2 text-xs font-medium text-text-primary text-left overflow-hidden text-ellipsis;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
  min-height: calc(var(--text-xs) * 1.3 * 2 + var(--space-1) * 2);
}

/* Active card visual feedback */
.controller-product-card--active .controller-product-card__position {
  background-color: var(--color-accent-blue);
}

/* Archived card visual feedback */
.controller-product-card--archived {
  @apply opacity-60;
}

.controller-product-card--archived .controller-product-card__position {
  background-color: var(--color-accent-amber);
}

.controller-product-card--archived::after {
  content: "";
  @apply absolute inset-0 z-[1] pointer-events-none;
  background: repeating-linear-gradient(
    45deg,
    transparent,
    transparent 10px,
    rgba(245, 158, 11, 0.1) 10px,
    rgba(245, 158, 11, 0.1) 20px
  );
}

/* ==========================================================================
   VOICE CONTROL PANEL (Bottom)
   ========================================================================== */

.controller-panel--voice {
  border-bottom: none;
}

.controller-panel--voice .voice-control-panel {
  @apply relative w-full bg-transparent border-none shadow-none;
  bottom: auto;
  right: auto;
  left: auto;
  border-radius: 0;
}

/* ==========================================================================
   RESPONSIVE ADJUSTMENTS
   ========================================================================== */

@media (min-width: 400px) {
  .controller-products__grid {
    @apply gap-3;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  }

  .controller-product-card__position {
    @apply min-w-[48px] h-12 text-3xl;
  }
}

@media (min-width: 600px) {
  .controller-products__grid {
    @apply gap-3;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }

  .controller-product-card__position {
    @apply min-w-[56px] h-14;
  }
}

@media (min-width: 1024px) {
  .controller-products__grid {
    @apply gap-4;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  }
}

/* ==========================================================================
   JUMP INDICATOR
   ========================================================================== */

.controller-jump-indicator {
  @apply fixed text-white text-5xl font-bold py-4 px-6 z-[9999] pointer-events-none opacity-0 min-w-[80px] text-center;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  background-color: rgba(0, 0, 0, 0.85);
  border-radius: var(--radius-lg);
  transition: opacity 0.15s ease, transform 0.15s ease;
}

.controller-jump-indicator.visible {
  @apply opacity-100;
  transform: translate(-50%, -50%) scale(1);
}

/* ==========================================================================
   FULL VIEWPORT MODE FOR CONTROLLER VIEW
   ========================================================================== */

body:has(.controller-container) {
  @apply overflow-hidden;
  height: 100vh;
  height: 100dvh;
}

body:has(.controller-container) .app-navbar {
  @apply hidden;
}

body:has(.controller-container) .app-content {
  @apply pt-0;
}

/* ===========================================================================
   MESSAGE PRESET MODAL CONTENT
   =========================================================================== */

.preset-modal-body {
  @apply flex flex-col gap-6;
}

.preset-empty {
  @apply p-8 text-center text-text-secondary;
}

.preset-list {
  @apply flex flex-col gap-3;
}

.preset-item {
  @apply flex items-stretch gap-2 bg-surface-secondary overflow-hidden;
  border: 1px solid var(--color-border-primary);
  border-radius: var(--radius-md);
  transition: border-color var(--transition-fast);
}

.preset-item:hover {
  border-color: var(--color-accent-blue);
}

.preset-item__select {
  @apply flex-1 flex items-center gap-3 p-4 bg-transparent border-none text-left cursor-pointer text-text-primary;
  transition: background-color var(--transition-fast);
}

.preset-item__select:hover {
  @apply bg-bg-hover;
}

.preset-item__color {
  @apply w-3 h-full shrink-0;
  border-radius: var(--radius-sm);
}

.preset-item__text {
  @apply flex-1 min-w-0 text-base font-medium text-text-primary text-left overflow-hidden text-ellipsis whitespace-nowrap;
}

.preset-item__delete {
  @apply px-4 bg-transparent border-none text-2xl text-text-tertiary cursor-pointer;
  border-left: 1px solid var(--color-border-primary);
  transition: all var(--transition-fast);
}

.preset-item__delete:hover {
  @apply text-white;
  background-color: var(--color-accent-red);
}

/* Create Preset Form */
.preset-create {
  @apply pt-6;
  border-top: 2px solid var(--color-border-primary);
}

.preset-create h3 {
  @apply text-lg font-semibold text-text-primary m-0 mb-4;
}

.preset-create .textarea {
  min-height: auto;
}

/* Color Selector */
.color-selector {
  @apply grid gap-3;
  grid-template-columns: repeat(3, 1fr);
}

.color-option {
  @apply flex flex-col items-center gap-2 p-3 cursor-pointer;
  border: 2px solid var(--color-border-primary);
  border-radius: var(--radius-md);
  transition: all var(--transition-fast);
}

.color-option:hover {
  @apply bg-bg-hover;
  border-color: var(--color-text-secondary);
}

.color-option input[type="radio"] {
  @apply absolute opacity-0 pointer-events-none;
}

.color-option input[type="radio"]:checked + .color-swatch {
  transform: scale(1.1);
  border-width: 3px;
}

.color-option:has(input[type="radio"]:checked) {
  @apply bg-bg-hover;
  border-color: var(--color-accent-blue);
}

.color-swatch {
  @apply w-10 h-10;
  border-radius: var(--radius-md);
  border: 2px solid rgba(255, 255, 255, 0.2);
  transition: all var(--transition-fast);
}

.color-label {
  @apply text-xs font-medium text-text-primary;
}

.form-actions {
  @apply flex justify-end mt-4;
}

/* ==========================================================================
   MESSAGE PANEL - MOBILE RESPONSIVE
   ========================================================================== */

@media (max-width: 400px) {
  .controller-color-btn {
    @apply w-[18px] h-[18px];
  }

  .controller-btn {
    @apply py-1.5 px-3 text-[13px];
  }

  .controller-btn--secondary {
    padding: 5px 11px;
  }

  .controller-message-actions {
    @apply gap-2;
  }

  .controller-message-buttons {
    @apply gap-1;
  }
}

/* ==========================================================================
   PRESET MODAL CONTENT - MOBILE RESPONSIVE
   ========================================================================== */

@media (max-width: 400px) {
  .preset-modal-body {
    @apply gap-4;
  }

  .color-selector {
    @apply gap-2;
    grid-template-columns: repeat(2, 1fr);
  }

  .color-option {
    @apply p-2;
  }

  .color-swatch {
    @apply w-8 h-8;
  }

  .preset-create {
    @apply pt-4;
  }

  .preset-create h3 {
    @apply text-base;
  }

  .form-group {
    @apply mb-3;
  }

  .preset-empty {
    @apply p-4;
  }

  .preset-item__select {
    @apply p-3 gap-2;
  }

  .preset-item__text {
    @apply text-sm;
  }

  .preset-item__delete {
    @apply px-3 text-xl;
  }
}
